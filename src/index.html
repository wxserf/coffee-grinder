<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; worker-src blob:"/>
  <title>Erin's Coffee Grinder v7.0 - Enhanced</title>
  <link rel="stylesheet" href="styles/main.css"/>
  <script>
    const env = window.NODE_ENV || 'development';
    const head = document.head;
    const addCss = href => {
      const l = document.createElement('link');
      l.rel = 'stylesheet';
      l.href = href;
      head.appendChild(l);
    };
    const addJs = src => {
      const s = document.createElement('script');
      s.src = src;
      head.appendChild(s);
    };
    if (env === 'production') {
      const cdn = 'https://cdnjs.cloudflare.com/ajax/libs';
      addCss(`${cdn}/codemirror/5.65.5/codemirror.min.css`);
      addJs(`${cdn}/codemirror/5.65.5/codemirror.min.js`);
      addJs(`${cdn}/codemirror/5.65.5/mode/javascript/javascript.min.js`);
      addJs(`${cdn}/ajv/8.12.0/ajv7.min.js`);
      addJs(`${cdn}/html2pdf.js/0.10.1/html2pdf.bundle.min.js`);
      addJs(`${cdn}/sorttable/2.1.0/sorttable.min.js`);
    } else {
      addCss('vendor/codemirror.css');
      addJs('vendor/codemirror.js');
      addJs('vendor/javascript.js');
      addJs('vendor/ajv7.min.js');
      addJs('vendor/html2pdf.bundle.min.js');
      addJs('vendor/sorttable.min.js');
    }
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Erin's Coffee Grinder v7.0</h1>
      <p>Enhanced Blueprint Analyzer - Recursive Processing, Structure & Details</p>
    </header>

    <div class="section meta-section">
      <h2>Metadata</h2>
      <label>Prepared By:</label>
      <input id="preparedBy" placeholder="Your name…" />
      <label>Recipient:</label>
      <input id="recipient" placeholder="Erin or team…" />
      <label>Version:</label>
      <input id="version" placeholder="e.g., 1.0" />
      <label>Objective:</label>
      <input id="objective" placeholder="High-level goal of this scenario…" />
    </div>

    <div class="section input-section">
      <h2>Blueprint Input</h2>
      <label>Upload .json Blueprint:</label>
      <input type="file" id="jsonUpload" accept="application/json" />
      <div id="uploadError" class="error" style="display:none"></div>
      <label>Or Paste JSON Blueprint:</label>
      <textarea id="jsonInput"></textarea>
      <div id="validateError" class="error" style="display:none"></div>
      <div id="parseWarning" class="warning" style="display:none"></div>
    </div>

    <button id="sampleBtn" class="button">Load Sample</button>
    <button id="generateBtn" class="button" disabled>Generate Spec</button>

    <div class="section output-section">
        <h2>Specification Output</h2>
        <div class="toggle-section" id="toggles" style="display:none">
            <label><input type="checkbox" id="showScenario" /> Scenario Details</label>
            <label><input type="checkbox" id="showConnections" /> Connections List</label>
            <label><input type="checkbox" id="showVars" /> Variables List</label>
            <label><input type="checkbox" id="showFilters" /> Show Filters</label>
            <label><input type="checkbox" id="showModuleDetails" checked /> Show Module Details Table</label>
        </div>

        <div id="progress" style="margin-top: 15px; margin-bottom:8px; font-style: italic; color: var(--muted);"></div>
        <div id="outputArea"></div>

        <div id="tableControls" style="margin-top:10px; display: none;">
            <input id="tableFilter" placeholder="Filter modules table…" />
        </div>
        <div class="export-buttons" style="margin-top:10px;">
            <button id="copyBtn" class="button" style="display:none">Copy Text</button>
            <button id="exportPdfBtn" class="button" style="display:none">Export PDF</button>
            <button id="exportMdBtn" class="button" style="display:none">Export Markdown</button>
            <button id="exportTxtBtn" class="button" style="display:none">Export Text</button>
        </div>
    </div>

  </div>

  <script type="module" src="scripts/cspNonce.js"></script>
  <script type="module" src="scripts/main.js"></script>
</body>
</html>
